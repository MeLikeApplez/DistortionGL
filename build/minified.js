function ht(h,s){return new Promise(e=>{h.then(t=>{e([t,null])}).catch(t=>{console.error(s||t),e([null,s||t])})})}var v=class{scene;canvasElement;constructor(s){this.scene=null,this.canvasElement=s}setSize(s,e,t=1){this.canvasElement.width=s*t,this.canvasElement.height=e*t}render(s,e){}};var B=class extends v{gl;static isAvailable(s){return!!s.getContext("webgl2")}constructor(s,e={}){super(s),this.gl=s.getContext("webgl2",e)}render(s,e){s.render(this)}};var d=class h{x;y;constructor(s=0,e=0){this.x=s,this.y=e}set(s,e){return this.x=s,this.y=e,this}add(s){return this.x+=s.x,this.y+=s.y,this}subtract(s){return this.x-=s.x,this.y-=s.y,this}multiply(s){return this.x*=s.x,this.y*=s.y,this}divide(s){return this.x/=s.x,this.y/=s.y,this}addScalar(s){return this.x+=s,this.y+=s,this}subtractScalar(s){return this.x-=s,this.y-=s,this}multiplyScalar(s){return this.x*=s,this.y*=s,this}divideScalar(s){return this.x/=s,this.y/=s,this}distanceTo(s){let e=s.x-this.x,t=s.y-this.y;return Math.sqrt(e*e+t*t)}distanceToSquared(s){let e=s.x-this.x,t=s.y-this.y;return e*e+t*t}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}clamp(s,e){return this.x=Math.max(s.x,Math.min(this.x,e.x)),this.y=Math.max(s.y,Math.min(this.y,e.y)),this}normalize(){let s=Math.sqrt(this.x*this.x+this.y*this.y);return s===0?(this.x=0,this.y=0):(this.x/=s,this.y/=s),this}dot(s){return this.x*s.x+this.y*s.y}equals(s){return this.x===s.x&&this.y===s.y}rotateAround(s,e){let t=Math.cos(e),i=Math.sin(e),r=this.x-s.x,o=this.y-s.y;return this.x=r*t-o*i+s.x,this.y=r*i+o*t+s.y,this}toArray(){return[this.x,this.y]}fromArray(s){return this.x=s[0],this.y=s[1],this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;default:return 0}}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}clone(){return new h(this.x,this.y)}copy(s){return this.x=s.x,this.y=s.y,this}};function Et(h,s){return Math.floor(Math.random()*(s-h+1)+h)}function Tt(h,s){return Math.random()*(s-h)+h}function St(h,s,e){return s<h?h:s>e?e:s}function At(h,s,e){return h+(s-h)*e}var f=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function L(){let h=Math.random()*4294967295|0,s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0;return f[h&255]+f[h>>8&255]+f[h>>16&255]+f[h>>24&255]+"-"+f[s&255]+f[s>>8&255]+"-"+f[s>>16&15|64]+f[s>>24&255]+"-"+f[e&63|128]+f[e>>8&255]+"-"+f[e>>16&255]+f[e>>24&255]+f[t&255]+f[t>>8&255]+f[t>>16&255]+f[t>>24&255]}function Pt(h,s){let e=h.constructor,t=e(h.length*s);for(let i=0;i<s;i++)for(let r=0;r<h.length;r++)t[h.length*i+r]=h[r];return t}var T=class{_listeners;constructor(s){if(this._listeners=new Map,Array.isArray(s))for(let e=0;e<s.length;e++)this._listeners.set(s[e],[])}createEvent(s){return this._listeners.set(s,[]),this}dispatchEvent(s,e){let t=this._listeners.get(s);if(!t)return!1;for(let i=0;i<t.length;i++)t[i].callback(e);return!0}listen(s,e){let t=this._listeners.get(s);if(!t)return new Error(`Unable to find event eventName: "${String(s)}"`);if(typeof e!="function")return new Error("Callback function is required!");let i=L();return t.push({uuid:i,callback:e}),i}};var $=class{events;animationId;startTime;fps;deltaTime;constructor(){this.events=new T(["onstart","onstop","onupdate"]),this.animationId=-1,this.startTime=-1,this.fps=0,this.deltaTime=0}start(){return this.startTime=-1,this.animationId=window.requestAnimationFrame(this.update.bind(this)),this.events.dispatchEvent("onstart",this),this.animationId}stop(){return window.cancelAnimationFrame(this.animationId),this.animationId=-1,this.startTime=-1,this.events.dispatchEvent("onstop",this),this.animationId}update(s){if(this.animationId=window.requestAnimationFrame(this.update.bind(this)),this.startTime===-1){this.startTime=s;return}this.deltaTime=(s-this.startTime)/1e3,this.fps=1/this.deltaTime,this.startTime=s,this.events.dispatchEvent("onupdate",this)}};var C=class h{x;y;z;w;constructor(s=0,e=0,t=0,i=1){this.x=s,this.y=e,this.z=t,this.w=i}set(s,e,t,i){return this.x=s,this.y=e,this.z=t,this.w=i,this}setFromEuler(s){let{a:e,b:t,c:i}=s.getEulerByOrder(),r=Math.sin(e/2),o=Math.sin(t/2),n=Math.sin(i/2),u=Math.cos(e/2),a=Math.cos(t/2),c=Math.cos(i/2);return this.x=u*a*c+r*o*n,this.y=r*a*c-u*o*n,this.z=u*o*c+r*a*n,this.w=u*a*n-r*o*c,this}setFromAxisAngle(s,e){let t=e*.5,i=Math.sin(t);return new h(s.x*i,s.y*i,s.z*i,Math.cos(t))}identity(){return this.set(0,0,0,1),this}normalize(){let s=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return s===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x/=s,this.y/=s,this.z/=s,this.w/=s),this}conjugate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=this.w,this}multiply(s){return this.x=this.w*s.x+this.x*s.w+this.y*s.z-this.z*s.y,this.y=this.w*s.y-this.x*s.z+this.y*s.w+this.z*s.x,this.z=this.w*s.z+this.x*s.y-this.y*s.x+this.z*s.w,this.w=this.w*s.w-this.x*s.x-this.y*s.y-this.z*s.z,this}clone(){return new h(this.x,this.y,this.z,this.w)}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w,this}};var z=class h{x;y;z;constructor(s=0,e=0,t=0){this.x=s,this.y=e,this.z=t}static UP=new h(0,1,0);set(s,e,t){return this.x=s,this.y=e,this.z=t,this}add(s){return this.x+=s.x,this.y+=s.y,this.z+=s.z,this}subtract(s){return this.x-=s.x,this.y-=s.y,this.z-=s.z,this}multiply(s){return this.x*=s.x,this.y*=s.y,this.z*=s.z,this}divide(s){return this.x/=s.x,this.y/=s.y,this.z/=s.z,this}addScalar(s){return this.x+=s,this.y+=s,this.z+=s,this}subtractScalar(s){return this.x-=s,this.y-=s,this.z-=s,this}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this}divideScalar(s){return this.x/=s,this.y/=s,this.z/=s,this}distanceTo(s){let e=s.x-this.x,t=s.y-this.y,i=s.z-this.z;return Math.sqrt(e*e+t*t+i*i)}distanceToSquared(s){let e=s.x-this.x,t=s.y-this.y,i=s.z-this.z;return e*e+t*t+i*i}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}clamp(s,e){return this.x=Math.max(s.x,Math.min(this.x,e.x)),this.y=Math.max(s.y,Math.min(this.y,e.y)),this.z=Math.max(s.z,Math.min(this.z,e.z)),this}normalize(){let s=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return s===0?(this.x=0,this.y=0,this.z=0):(this.x/=s,this.y/=s,this.z/=s),this}applyFromMatrix3(s){let{x:e,y:t,z:i}=this;return this.x=s[0]*e+s[1]*t+s[2]*i,this.y=s[3]*e+s[4]*t+s[5]*i,this.z=s[6]*e+s[7]*t+s[8]*i,this}applyQuaternion(s){let e=2*(s.x*this.y-s.w*this.x+s.y*this.z),t=2*(s.y*this.x-s.w*this.y+s.x*this.z),i=2*(s.z*this.x-s.w*this.z-s.x*this.y);return this.x=e,this.y=t,this.z=i,this}applyEuler(s){let e=new C().setFromEuler(s);return this.applyQuaternion(e)}dot(s){return this.x*s.x+this.y*s.y+this.z*s.z}cross(s){return new h(this.y*s.z-this.z*s.y,this.z*s.x-this.x*s.z,this.x*s.y-this.y*s.x)}setFromCylindricalCoordinates(s,e,t){return this.x=s*Math.sin(t)*Math.cos(e),this.y=s*Math.sin(t)*Math.sin(e),this.z=s*Math.cos(t),this}equals(s){return this.x===s.x&&this.y===s.y&&this.z===s.z}toArray(){return[this.x,this.y,this.z]}fromArray(s){return this.x=s[0],this.y=s[1],this.z=s[2],this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:return 0}}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}clone(){return new h(this.x,this.y,this.z)}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this}};var g=class h extends Array{constructor(s=1,e=0,t=0,i=0,r=0,o=1,n=0,u=0,a=0,c=0,m=1,x=0,p=0,y=0,b=0,l=1){super(16),this[0]=s,this[1]=e,this[2]=t,this[3]=i,this[4]=r,this[5]=o,this[6]=n,this[7]=u,this[8]=a,this[9]=c,this[10]=m,this[11]=x,this[12]=p,this[13]=y,this[14]=b,this[15]=l}set(s,e,t,i,r,o,n,u,a,c,m,x,p,y,b,l){return this[0]=s,this[1]=e,this[2]=t,this[3]=i,this[4]=r,this[5]=o,this[6]=n,this[7]=u,this[8]=a,this[9]=c,this[10]=m,this[11]=x,this[12]=p,this[13]=y,this[14]=b,this[15]=l,this}setFromMatrix4(s){return this[0]=s[0],this[1]=s[1],this[2]=s[2],this[3]=s[3],this[4]=s[4],this[5]=s[5],this[6]=s[6],this[7]=s[7],this[8]=s[8],this[9]=s[9],this[10]=s[10],this[11]=s[11],this[12]=s[12],this[13]=s[13],this[14]=s[14],this[15]=s[15],this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}makeTranslation(s,e,t){return this.set(1,0,0,s,0,1,0,e,0,0,1,t,0,0,0,1),this}translate(s,e,t){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,s,e,t,1),this}makeScale(s,e,t){return this.set(s,0,0,0,0,e,0,0,0,0,t,0,0,0,0,1),this}makeRotationX(s){let e=Math.sin(s),t=Math.cos(s);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this}makeRotationY(s){let e=Math.sin(s),t=Math.cos(s);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this}makeRotationZ(s){let e=Math.sin(s),t=Math.cos(s);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationFromEuler(s){let{s1:e,s2:t,s3:i,c1:r,c2:o,c3:n}=s.getEulerByOrderTrig();switch(s.order){case"XZX":return this.set(o,-n*t,t*i,0,r*t,r*o*n-e*i,-n*e-r*o*i,0,e*t,r*i+o*n*e,r*n-o*e*i,0,0,0,0,1);case"XYX":return this.set(o,t*i,n*t,0,e*t,r*n-o*e*i,-(r*i)-o*n*e,0,-r*t,n*e+r*o*i,r*o*n-e*i,0,0,0,0,1);case"YXY":return this.set(r*n-o*e*i,e*t,r*i+o*n*e,0,t*i,o,-n*t,0,-n*e- -r*o*i,r*t,r*o*n-e*i,0,0,0,0,1);case"YZY":return this.set(r*o*n-e*i,-r*t,n*e+r*o*i,0,n*t,o,t*i,0,-r*i-o*n*e,e*t,r*n-o*e*i,0,0,0,0,1);case"ZYZ":return this.set(r*o*n-e*i,-n*e-r*o*i,r*t,0,r*i+o*n*e,r*n-o*e*i,e*t,0,-n*t,t*i,o,0,0,0,0,1);case"ZXZ":return this.set(r*n-o*e*i,-r*i-o*n*e,e*t,0,n*e+r*o*i,r*o*n-e*i,-r*t,0,t*i,n*t,o,0,0,0,0,1);case"XZY":return this.set(o*n,-t,o*i,0,e*i+r*n*t,r*o,r*t*i-n*e,0,n*e*t-r*i,o*e,r*n+e*t*i,0,0,0,0,1);case"XYZ":return this.set(o*n,-o*i,t,0,r*i+n*e*t,r*n-e*t*i,-o*e,0,e*i-r*n*t,n*e+r*t*i,r*o,0,0,0,0,1);case"YXZ":return this.set(r*n+e*t*i,n*e*t-r*i,o*e,0,o*i,o*n,-t,0,r*t*i-n*e,r*n*t+e*i,r*o,0,0,0,0,1);case"YZX":return this.set(r*o,e*i-r*n*t,n*e+r*t*i,0,t,o*n,-o*i,0,-o*e,r*i+n*e*t,r*n-e*t*i,0,0,0,0,1);case"ZYX":return this.set(r*o,r*t*i-n*e,e*i+r*n*t,0,o*e,r*n+e*t*i,n*e*t-r*i,0,-t,o*i,o*n,0,0,0,0,1);case"ZXY":return this.set(r*n-e*t*i,-r*e,r*i+n*e*t,0,n*e+r*t*i,r*o,e*i-r*n*t,0,-o*i,t,o*n,0,0,0,0,1)}return null}makeRotationFromQuaternion(s){let e=s.x*s.x,t=s.y*s.y,i=s.z*s.z,r=s.x*s.y,o=s.x*s.z,n=s.y*s.z,u=s.x*s.w,a=s.y*s.w,c=s.z*s.w,m=1-(2*t-2*i),x=2*r-2*c,p=2*o+2*a,y=2*r+2*c,b=1-(2*e-2*i),l=2*n-2*u,M=2*o-2*a,w=2*n+2*u,E=1-(2*e-2*t);return this.set(m,x,p,0,y,b,l,0,M,w,E,0,0,0,0,1)}multiply(s){return this.multiplyMatrices(this,s),this}multiplyMatrices(s,e){let t=s,i=e,r=this,o=t[0],n=t[4],u=t[8],a=t[12],c=t[1],m=t[5],x=t[9],p=t[13],y=t[2],b=t[6],l=t[10],M=t[14],w=t[3],E=t[7],R=t[11],P=t[15],V=i[0],U=i[4],k=i[8],Z=i[12],D=i[1],I=i[5],j=i[9],_=i[13],G=i[2],W=i[6],X=i[10],Y=i[14],K=i[3],O=i[7],Q=i[11],H=i[15];return r[0]=o*V+n*D+u*G+a*K,r[4]=o*U+n*I+u*W+a*O,r[8]=o*k+n*j+u*X+a*Q,r[12]=o*Z+n*_+u*Y+a*H,r[1]=c*V+m*D+x*G+p*K,r[5]=c*U+m*I+x*W+p*O,r[9]=c*k+m*j+x*X+p*Q,r[13]=c*Z+m*_+x*Y+p*H,r[2]=y*V+b*D+l*G+M*K,r[6]=y*U+b*I+l*W+M*O,r[10]=y*k+b*j+l*X+M*Q,r[14]=y*Z+b*_+l*Y+M*H,r[3]=w*V+E*D+R*G+P*K,r[7]=w*U+E*I+R*W+P*O,r[11]=w*k+E*j+R*X+P*Q,r[15]=w*Z+E*_+R*Y+P*H,this}multiplyScalar(s){for(let e=0;e<this.length;e++)this[e]*=s;return this}inverse(){let e=new h,t=this;e[0]=t[5]*t[10]*t[15]-t[5]*t[14]*t[11]-t[6]*t[9]*t[15]+t[6]*t[13]*t[11]+t[7]*t[9]*t[14]-t[7]*t[13]*t[10],e[1]=-t[1]*t[10]*t[15]+t[1]*t[14]*t[11]+t[2]*t[9]*t[15]-t[2]*t[13]*t[11]-t[3]*t[9]*t[14]+t[3]*t[13]*t[10],e[2]=t[1]*t[6]*t[15]-t[1]*t[14]*t[7]-t[2]*t[5]*t[15]+t[2]*t[13]*t[7]+t[3]*t[5]*t[14]-t[3]*t[13]*t[6],e[3]=-t[1]*t[6]*t[11]+t[1]*t[10]*t[7]+t[2]*t[5]*t[11]-t[2]*t[9]*t[7]-t[3]*t[5]*t[10]+t[3]*t[9]*t[6],e[4]=-t[4]*t[10]*t[15]+t[4]*t[14]*t[11]+t[6]*t[8]*t[15]-t[6]*t[12]*t[11]-t[7]*t[8]*t[14]+t[7]*t[12]*t[10],e[5]=t[0]*t[10]*t[15]-t[0]*t[14]*t[11]-t[2]*t[8]*t[15]+t[2]*t[12]*t[11]+t[3]*t[8]*t[14]-t[3]*t[12]*t[10],e[6]=-t[0]*t[6]*t[15]+t[0]*t[14]*t[7]+t[2]*t[4]*t[15]-t[2]*t[12]*t[7]-t[3]*t[4]*t[14]+t[3]*t[12]*t[6],e[7]=t[0]*t[6]*t[11]-t[0]*t[10]*t[7]-t[2]*t[4]*t[11]+t[2]*t[8]*t[7]+t[3]*t[4]*t[10]-t[3]*t[8]*t[6],e[8]=t[4]*t[9]*t[15]-t[4]*t[13]*t[11]-t[5]*t[8]*t[15]+t[5]*t[12]*t[11]+t[7]*t[8]*t[13]-t[7]*t[12]*t[9],e[9]=-t[0]*t[9]*t[15]+t[0]*t[13]*t[11]+t[1]*t[8]*t[15]-t[1]*t[12]*t[11]-t[3]*t[8]*t[13]+t[3]*t[12]*t[9],e[10]=t[0]*t[5]*t[15]-t[0]*t[13]*t[7]-t[1]*t[4]*t[15]+t[1]*t[12]*t[7]+t[3]*t[4]*t[13]-t[3]*t[12]*t[5],e[11]=-t[0]*t[5]*t[11]+t[0]*t[9]*t[7]+t[1]*t[4]*t[11]-t[1]*t[8]*t[7]-t[3]*t[4]*t[9]+t[3]*t[8]*t[5],e[12]=-t[4]*t[9]*t[14]+t[4]*t[13]*t[10]+t[5]*t[8]*t[14]-t[5]*t[12]*t[10]-t[6]*t[8]*t[13]+t[6]*t[12]*t[9],e[13]=t[0]*t[9]*t[14]-t[0]*t[13]*t[10]-t[1]*t[8]*t[14]+t[1]*t[12]*t[10]+t[2]*t[8]*t[13]-t[2]*t[12]*t[9],e[14]=-t[0]*t[5]*t[14]+t[0]*t[13]*t[6]+t[1]*t[4]*t[14]-t[1]*t[12]*t[6]-t[2]*t[4]*t[13]+t[2]*t[12]*t[5],e[15]=t[0]*t[5]*t[10]-t[0]*t[9]*t[6]-t[1]*t[4]*t[10]+t[1]*t[8]*t[6]+t[2]*t[4]*t[9]-t[2]*t[8]*t[5];let i=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12];for(var r=0;r<16;r++)e[r]/=i;return this.set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]),this}compose(s,e,t){let i=this,r=e.x,o=e.y,n=e.z,u=e.w,a=r+r,c=o+o,m=n+n,x=r*a,p=r*c,y=r*m,b=o*c,l=o*m,M=n*m,w=u*a,E=u*c,R=u*m,P=t.x,V=t.y,U=t.z;return i[0]=(1-(b+M))*P,i[1]=(p+R)*P,i[2]=(y-E)*P,i[3]=0,i[4]=(p-R)*V,i[5]=(1-(x+M))*V,i[6]=(l+w)*V,i[7]=0,i[8]=(y+E)*U,i[9]=(l-w)*U,i[10]=(1-(x+b))*U,i[11]=0,i[12]=s.x,i[13]=s.y,i[14]=s.z,i[15]=1,this}clone(){return new h(...this)}copy(s){return this.set(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15])}};var F=class h{x;y;z;order;constructor(s=0,e=0,t=0){this.x=s,this.y=e,this.z=t,this.order="XYZ"}set(s,e,t,i){return this.x=s,this.y=e,this.z=t,this.order=i||"XYZ",this}setFromQuaternion(s){let e=2*(s.w*s.x+s.y*s.z),t=1-2*(s.x*s.x+s.y*s.y);this.x=Math.atan2(e,t);let i=2*(s.w*s.y-s.x*s.z),r=Math.sqrt(1+i),o=Math.sqrt(1-i);this.y=2*Math.atan2(r,o)-Math.PI/2;let n=2*(s.w*s.z+s.x*s.y),u=1-2*(s.y*s.y+s.z*s.z);return this.z=Math.atan2(n,u),this}getEulerByOrder(){let s=this.order[0]==="X"?this.x:this.order[0]==="Y"?this.y:this.order[0]==="Z"?this.z:0,e=this.order[1]==="X"?this.x:this.order[1]==="Y"?this.y:this.order[1]==="Z"?this.z:0,t=this.order[2]==="X"?this.x:this.order[2]==="Y"?this.y:this.order[2]==="Z"?this.z:0;return{a:s,b:e,c:t}}getEulerByOrderTrig(){let{a:s,b:e,c:t}=this.getEulerByOrder(),i=Math.sin(s),r=Math.sin(e),o=Math.sin(t),n=Math.cos(s),u=Math.cos(e),a=Math.cos(t);return{s1:i,s2:r,s3:o,c1:n,c2:u,c3:a}}setFromRotationMatrix(s){return this.x=Math.atan2(s[9],s[10]),this.y=Math.atan2(-s[8],Math.sqrt(s[9]*s[9]+s[10]*s[10])),this.z=Math.atan2(s[4],s[0]),this}reorder(s){return this.order=s,this}clone(){return new h(this.x,this.y,this.z)}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this}};var S=class extends T{constructor(){super()}load(...s){}};var N=class extends S{constructor(){super()}};var J=class extends S{name;vertexCode;fragmentCode;program;uniforms;attributes;preloaded;ready;error;constructor(s){if(super(),this.name=s?.name||"Shader",this.vertexCode=null,this.fragmentCode=null,this.uniforms={},this.attributes={},this.program=null,this.preloaded=!1,this.ready=!1,this.error=null,this._setUniformsAndAttributes(s),s.type==="source-code")this.vertexCode=s.vertexShader,this.fragmentCode=s.fragmentShader;else if(s.type==="url")this._setSourceCodeFromURL(s.vertexShader,s.fragmentShader);else throw Error("Invalid Shader Loader options!")}static loadAll(s,e,t=!1){for(let i=0;i<e.length;i++)e[i].load(s,t)}async _setSourceCodeFromURL(s,e){let[t,i]=await Promise.allSettled([fetch(s),fetch(e)]);if(t.status==="rejected"||!t.value.ok)return this.ready=!1,this.error=new Error("Failed to fetch vertex shader!"),this.dispatchEvent("onerror",this.error),void console.error(this.error);if(i.status==="rejected"||!i.value.ok)return this.ready=!1,this.error=new Error("Failed to fetch fragment shader!"),this.dispatchEvent("onerror",this.error),void console.error(this.error);let[r,o]=await Promise.allSettled([t.value.text(),i.value.text()]);if(r.status==="rejected")return this.ready=!1,this.error=new Error("Failed to parse text for vertex shader!"),this.dispatchEvent("onerror",this.error),void console.error(this.error);if(o.status==="rejected")return this.ready=!1,this.error=new Error("Failed to parse text for fragment shader!"),this.dispatchEvent("onerror",this.error),void console.error(this.error);this.vertexCode=r.value,this.fragmentCode=o.value}_setUniformsAndAttributes(s){if(Array.isArray(s.uniforms))for(let e=0;e<s.uniforms.length;e++){let t=s.uniforms[e];this.uniforms[t]=null}if(Array.isArray(s.attributes))for(let e=0;e<s.attributes.length;e++){let t=s.attributes[e];this.attributes[t]=-1}}load(s,e=!1){if(!e&&this.ready&&this.program&&!this.error)return;let t=s.createShader(s.VERTEX_SHADER);if(!t)return void console.error("Failed to create vertex shader!");if(this.vertexCode===null)return void console.error("Vertex shader code is not a string!");if(this.fragmentCode===null)return void console.error("Fragment shader code is not a string!");if(s.shaderSource(t,this.vertexCode),s.compileShader(t),!s.getShaderParameter(t,s.COMPILE_STATUS)){let u=s.getShaderInfoLog(t),a=new Error(`[Vertex Shader]: "${u}"`);return this.program=null,this.ready=!1,this.error=a,this.dispatchEvent("onerror",a),void console.error(a)}let i=s.createShader(s.FRAGMENT_SHADER);if(!i)return void console.error("Failed to create fragment shader!");if(s.shaderSource(i,this.fragmentCode),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS)){let u=s.getShaderInfoLog(i),a=new Error(`[Fragment Shader]: "${u}"`);return this.program=null,this.ready=!1,this.error=a,this.dispatchEvent("onerror",a),void console.error(a)}let r=s.createProgram();if(s.attachShader(r,t),s.attachShader(r,i),s.linkProgram(r),!s.getProgramParameter(r,s.LINK_STATUS)){let u=s.getProgramInfoLog(r),a=new Error(`[Link Shader]: "${u}"`);return this.program=null,this.ready=!1,this.error=a,this.dispatchEvent("onerror",a),void console.error(a)}let o=s.getProgramParameter(r,s.ACTIVE_UNIFORMS);for(let u=0;u<o;u++){let a=s.getActiveUniform(r,u);a!==null&&(this.uniforms[a.name]=s.getUniformLocation(r,a.name))}let n=s.getProgramParameter(r,s.ACTIVE_ATTRIBUTES);for(let u=0;u<n;u++){let a=s.getActiveAttrib(r,u);a!==null&&(this.attributes[a.name]=s.getAttribLocation(r,a.name))}this.program=r,this.ready=!0,this.error=null,this.dispatchEvent("onload",this.program)}};var q=class extends S{constructor(){super()}load(s,e,t){let i=new Image;i.src=s,i.onload=()=>{e&&e(i),this.dispatchEvent("onload",i)},i.onerror=r=>{t&&t(r),this.dispatchEvent("onerror",r)}}};var tt=class{uuid;name;type;position;scale;rotation;quaternion;matrix;matrixAutoUpdate;matrixNeedsUpdate;autoUpdate;needsUpdate;constructor(){this.uuid=L(),this.name="",this.type="",this.position=null,this.scale=null,this.rotation=null,this.quaternion=null,this.matrix=null,this.matrixAutoUpdate=!1,this.matrixNeedsUpdate=!1,this.autoUpdate=!1,this.needsUpdate=!1}dispose(s,...e){}update(s,...e){}render(s,...e){}};var st=class{element;position;down;drag;offset;mouseScroll;isPointerDragging;isPointerDown;isPointerUp;devicePixelRatio;events;constructor(s,e=1){this.element=s,this.position=new d(0,0),this.down=new d(0,0),this.drag=new d(0,0),this.offset=new d(0,0),this.mouseScroll=0,this.isPointerDragging=!1,this.isPointerDown=!1,this.isPointerUp=!0,this.devicePixelRatio=e,this.events=new T(["onpointerup","onpointermove","onpointerdown","onmousescroll"]),s&&this.load(s)}dispose(){return this.element?(this.position.set(0,0),this.down.set(0,0),this.drag.set(0,0),this.offset.set(0,0),this.element.onpointerdown=null,this.element.onpointermove=null,this.element.onpointerup=null,this.element.onwheel=null,this.element=null,!0):!1}load(s){return this.element=s,s.onwheel=e=>{this.mouseScroll+=e.deltaY,this.events.dispatchEvent("onmousescroll",this)},s.onpointerdown=e=>{this.isPointerDown=!0,this.isPointerUp=!1;let t=s.getBoundingClientRect();this.position.set(this.devicePixelRatio*(e.clientX-t.left+this.offset.x),this.devicePixelRatio*(e.clientY-t.top+this.offset.y)),this.drag.set(0,0),!this.isPointerDragging&&this.isPointerDown&&(this.isPointerDragging=!0,this.down.copy(this.position)),this.events.dispatchEvent("onpointerdown",this)},s.onpointermove=e=>{let t=s.getBoundingClientRect();this.position.set(this.devicePixelRatio*(e.clientX-t.left+this.offset.x),this.devicePixelRatio*(e.clientY-t.top+this.offset.y)),this.isPointerDown&&this.drag.set(this.position.x-this.down.x,this.position.y-this.down.y),this.events.dispatchEvent("onpointermove",this)},s.onpointerup=e=>{this.isPointerDown=!1,this.isPointerUp=!0,this.isPointerDragging&&(this.isPointerDragging=!1,this.down.set(0,0),this.drag.set(0,0)),this.events.dispatchEvent("onpointerup",this)},!0}};var et=class{element;camera;_initialRotatePosition;rotatePosition;_initialZoom;zoomDistance;drag;rotateSpeed;panSpeed;zoomSpeed;minZoom;maxZoom;enableOrbit;enableZoom;constructor(s,e){this.element=s,this.camera=e,this._initialRotatePosition=new d(0,0),this.rotatePosition=new d(0,0),this._initialZoom=0,this.zoomDistance=0,this.drag=new d(0,0),this.rotateSpeed=1,this.panSpeed=1,this.zoomSpeed=1,this.minZoom=0,this.maxZoom=10,this.enableOrbit=!0,this.enableZoom=!0}dispose(){return this.element?(this.element=null,this._initialRotatePosition.set(0,0),this.rotatePosition.set(0,0),this.drag=new d(0,0),!0):!1}orbit(s){if(!this.enableOrbit)return;if(this.rotatePosition.copy(s.position),!this.element||s.isPointerUp){this.drag.set(0,0),this._initialRotatePosition.copy(this.rotatePosition);return}this.drag.x=this.rotatePosition.x-this._initialRotatePosition.x,this.drag.y=this.rotatePosition.y-this._initialRotatePosition.y;let{width:e,height:t}=this.element.getBoundingClientRect(),i=this.camera.position.distanceTo(this.camera.target),r=this.drag.x/e*i*this.rotateSpeed,o=this.drag.y/t*i*this.rotateSpeed,n=new z(this.camera.position.x,this.camera.position.y,this.camera.position.z).subtract(this.camera.target),u=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z),a=Math.atan2(n.z,n.x)+r,c=Math.asin(n.y/u)+o;this.camera.position.set(u*Math.cos(c)*Math.cos(a),u*Math.sin(c),u*Math.cos(c)*Math.sin(a)).add(this.camera.target),this.camera.lookAt(this.camera.target),this._initialRotatePosition.copy(this.rotatePosition)}zoom(s){if(!this.enableZoom||!this.element||this._initialZoom===s.mouseScroll)return;let t=(this._initialZoom-s.mouseScroll>0?-1:1)*this.zoomSpeed;if(this.zoomDistance+t<this.minZoom||this.zoomDistance+t>this.maxZoom){this._initialZoom=s.mouseScroll;return}this.zoomDistance+=t;let i=new z(this.camera.position.x,this.camera.position.y,this.camera.position.z).subtract(this.camera.target).normalize().multiplyScalar(t);this.camera.position.add(i),this._initialZoom=s.mouseScroll}};var it=class{_listeners;constructor(s){if(this._listeners=new Map,Array.isArray(s))for(let e=0;e<s.length;e++)this._listeners.set(s[e],[])}createEvent(s){return this._listeners.set(s,[]),this}removeEvent(s){this._listeners.delete(s)}dispatchEvent(s,e){let t=this._listeners.get(s);if(!t)return!1;for(let i=0;i<t.length;i++)t[i].callback(e);return!0}listen(s,e){let t=this._listeners.get(s);if(!t)return new Error(`Unable to find event eventName: "${String(s)}"`);if(typeof e!="function")return new Error("Callback function is required!");let i=L();return t.push({uuid:i,callback:e}),i}unlisten(s,e){let t=this._listeners.get(s);if(!t)return new Error(`Unable to find event eventName: "${String(s)}"`);let i=t.findIndex(r=>r.uuid===e);return i===-1?new Error(`Unable to find listener function with uuid: "${e}"`):(t.splice(i,1),!0)}};var A=class{position;rotation;projectionMatrix;target;autoUpdate;needsUpdate;constructor(){this.position=new z(0,0,0),this.rotation=new F,this.projectionMatrix=new g,this.target=new z(0,0,0),this.autoUpdate=!1,this.needsUpdate=!1}updateProjectionMatrix(){}render(s,...e){}};var rt=class extends A{fov;aspect;near;far;rotationMatrix;constructor(s,e,t,i){super(),this.fov=s,this.aspect=e,this.near=t,this.far=i,this.rotationMatrix=new g,this.updateProjectionMatrix()}lookAt(s,e=z.UP){let t=this.position.clone().subtract(s).normalize(),i=e.cross(t).normalize(),r=t.cross(i).normalize(),o=new g(i.x,i.y,i.z,0,r.x,r.y,r.z,0,t.x,t.y,t.z,0,0,0,0,1);return this.target.set(s.x,s.y,s.z),this.rotationMatrix.setFromMatrix4(o),this.rotation.setFromRotationMatrix(this.rotationMatrix),this}updateProjectionMatrix(){let s=this.fov*(Math.PI/180),e=1/Math.tan(s/2),t=1/(this.near-this.far);return this.projectionMatrix.set(e/this.aspect,0,0,0,0,e,0,0,0,0,(this.near+this.far)*t,-1,0,0,this.near*this.far*t*2,0),this.rotationMatrix.makeRotationFromEuler(this.rotation),this.needsUpdate=!1,this}render(s,e){s.gl.uniform3f(e.position,this.position.x,this.position.y,this.position.z),s.gl.uniformMatrix4fv(e.projection,!1,this.projectionMatrix),s.gl.uniformMatrix4fv(e.rotation,!1,this.rotationMatrix)}};var nt=class extends A{left;right;top;bottom;aspect;near;far;zoom;rotationMatrix;constructor(s,e,t,i,r,o,n){super(),this.left=s,this.right=e,this.top=t,this.bottom=i,this.aspect=r,this.near=o,this.far=n,this.zoom=1,this.rotationMatrix=new g,this.updateProjectionMatrix()}lookAt(s,e=z.UP){let t=this.position.clone().subtract(s).normalize(),i=e.cross(t).normalize(),r=t.cross(i).normalize(),o=new g(i.x,i.y,i.z,0,r.x,r.y,r.z,0,t.x,t.y,t.z,0,0,0,0,1);return this.target.set(s.x,s.y,s.z),this.rotationMatrix.setFromMatrix4(o),this.rotation.setFromRotationMatrix(this.rotationMatrix),this}updateProjectionMatrix(s=!1){let e=this.right*this.aspect,t=this.left*this.aspect,i=(e-t)/(2*this.zoom),r=(this.top-this.bottom)/(2*this.zoom),o=(e+t)/2,n=(this.top+this.bottom)/2,u=o-i,a=o+i,c=n+r,m=n-r,x=2/(a-u),p=2/(c-m),y=-(a+u)/(a-u),b=-(c+m)/(c-m),l=0,M=0;return s?(l=1/(this.far-this.near),M=this.far/(this.far-this.near)):(l=-2/(this.far-this.near),M=-(this.far+this.near)/(this.far-this.near)),this.projectionMatrix.set(x,0,0,y,0,p,0,b,0,0,l,M,0,0,0,1),this.rotationMatrix.makeRotationFromEuler(this.rotation),this}render(s,e){s.gl.uniform3f(e.position,this.position.x,this.position.y,this.position.z),s.gl.uniformMatrix4fv(e.projection,!1,this.projectionMatrix),s.gl.uniformMatrix4fv(e.rotation,!1,this.rotationMatrix)}};var ot=class extends A{zoom;resolution;minZoom;maxZoom;zoomScaleFactor;constructor(){super(),this.zoom=new d(1,1),this.resolution=new d(1,1),this.minZoom=.5,this.maxZoom=4,this.zoomScaleFactor=.1}updateProjectionMatrix(){this.projectionMatrix[0]=this.zoom.x/this.resolution.x,this.projectionMatrix[5]=this.zoom.y/this.resolution.y,this.needsUpdate=!1}render(s,e){s.gl.uniform3f(e.position,this.position.x,this.position.y,this.position.z),s.gl.uniformMatrix4fv(e.projection,!1,this.projectionMatrix)}};export{ht as Promisify,St as clamp,Pt as extendArray,L as generateUUID,At as lerp,Tt as randomFloat,Et as randomInt};
